<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="twilight"><meta name="keywords" content="rust, rustlang, rust-lang, twilight"><title>twilight - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-f0e60a452d3144ec.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-4743e13df3dfe8c4.css"><link rel="stylesheet" disabled href="../static.files/dark-0e1b889528bd466b.css"><link rel="stylesheet" disabled href="../static.files/ayu-65289d5d067c7c66.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-bc1b32400f872ddb.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../twilight/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../twilight/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate twilight</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.14.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">twilight</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/twilight/lib.rs.html#1">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="twilight"><a href="#twilight">twilight</a></h2>
<p><a href="https://app.codecov.io/gh/twilight-rs/twilight/"><img src="https://img.shields.io/codecov/c/gh/twilight-rs/twilight?logo=codecov&amp;style=for-the-badge&amp;token=E9ERLJL0L2" alt="codecov badge" /></a> <a href="https://discord.gg/7jj8n7D"><img src="https://img.shields.io/discord/745809834183753828?color=%237289DA&amp;label=discord%20server&amp;logo=discord&amp;style=for-the-badge" alt="discord badge" /></a> <a href="https://github.com/twilight-rs/twilight"><img src="https://img.shields.io/badge/github-twilight-6f42c1.svg?style=for-the-badge&amp;logo=github" alt="github badge" /></a> <a href="https://github.com/twilight-rs/twilight/blob/main/LICENSE.md"><img src="https://img.shields.io/badge/license-ISC-blue.svg?style=for-the-badge&amp;logo=pastebin" alt="license badge" /></a> <img src="https://img.shields.io/badge/rust-1.64+-93450a.svg?style=for-the-badge&amp;logo=rust" alt="rust badge" /></p>
<p><img src="https://raw.githubusercontent.com/twilight-rs/twilight/main/logo.png" alt="project logo" /></p>
<p><code>twilight</code> is a powerful, flexible, and scalable ecosystem of Rust libraries
for the Discord API.</p>
<p>The ecosystem of first-class crates includes <a href="https://twilight.rs/chapter_1_crates/section_4_cache_inmemory.html"><code>twilight-cache-inmemory</code></a>,
<a href="https://twilight.rs/chapter_1_crates/section_3_gateway.html"><code>twilight-gateway</code></a>, <a href="https://twilight.rs/chapter_1_crates/section_2_http.html"><code>twilight-http</code></a>, <a href="https://twilight.rs/chapter_1_crates/section_1_model.html"><code>twilight-model</code></a>, and more. These
are explained in detail below.</p>
<p>The main <code>twilight</code> crate is purely an advertisement crate: it has <em>no</em>
functionality. Please use the individual crates listed below instead!</p>
<h3 id="installation"><a href="#installation">Installation</a></h3>
<p>Twilight supports a MSRV of Rust 1.64+.</p>
<p>We recommend that most users start out with these crates:</p>
<ul>
<li><a href="https://crates.io/crates/twilight-cache-inmemory"><code>twilight-cache-inmemory</code></a></li>
<li><a href="https://crates.io/crates/twilight-gateway"><code>twilight-gateway</code></a></li>
<li><a href="https://crates.io/crates/twilight-http"><code>twilight-http</code></a></li>
<li><a href="https://crates.io/crates/twilight-model"><code>twilight-model</code></a></li>
</ul>
<p>If you need any other functionality that Twilight provides, you can just add
that dependency in.</p>
<h3 id="core-crates"><a href="#core-crates">Core Crates</a></h3>
<p>These are essential crates that most users will use together for a full
development experience. You may not need all of these - such as
<a href="https://twilight.rs/chapter_1_crates/section_4_cache_inmemory.html"><code>twilight-cache-inmemory</code></a> - but they are often used together to accomplish
most of what you need.</p>
<h4 id="twilight-model"><a href="#twilight-model"><code>twilight-model</code></a></h4>
<p>Models defining structures, enums, and bitflags for the entirety of the
Discord API. It is split into a number of sub-modules, such as <code>gateway</code> for
containing the WebSocket gateway types, <code>guild</code> for containing types owned
by guilds (servers), <code>voice</code> containing the types used by the Voice
WebSocket API, and more.</p>
<p>These are all in a single crate so that you can use <code>gateway</code> models without
depending on <a href="https://twilight.rs/chapter_1_crates/section_3_gateway.html"><code>twilight-gateway</code></a>. One use case is if you write your own
WebSocket gateway implementation.</p>
<h4 id="twilight-cache-inmemory"><a href="#twilight-cache-inmemory"><code>twilight-cache-inmemory</code></a></h4>
<p>In-process-memory based cache over objects received from the gateway. It’s
responsible for holding and managing information about things like guilds,
channels, role information, voice states, and any other events that come
from Discord.</p>
<h4 id="twilight-gateway"><a href="#twilight-gateway"><code>twilight-gateway</code></a></h4>
<p>Implementation of Discord’s sharding gateway sessions. This is responsible
for receiving stateful events in real-time from Discord and sending <em>some</em>
stateful information.</p>
<h4 id="twilight-http"><a href="#twilight-http"><code>twilight-http</code></a></h4>
<p>HTTP client supporting all of the Discord REST API. It is based on <code>hyper</code>.
It meets Discord’s ratelimiting requirements and supports proxying.</p>
<h4 id="twilight-standby"><a href="#twilight-standby"><code>twilight-standby</code></a></h4>
<p>Event processor that allows for tasks to wait for an event to come in. This
is useful, for example, when you have a reaction menu and want to wait for a
specific reaction on it to come in.</p>
<h3 id="additional-crates"><a href="#additional-crates">Additional Crates</a></h3>
<p>These are crates that are officially supported by Twilight, but aren’t
considered core crates due to being vendor-specific or non-essential for
most users.</p>
<h4 id="twilight-lavalink"><a href="#twilight-lavalink"><code>twilight-lavalink</code></a></h4>
<p>Client for <a href="https://github.com/freyacodes/Lavalink">Lavalink</a> as part of the twilight ecosystem.</p>
<p>It includes support for managing multiple nodes, a player manager for
conveniently using players to send events and retrieve information for each
guild, and an HTTP module for creating requests using the <a href="https://crates.io/crates/http"><code>http</code></a> crate and
providing models to deserialize their responses.</p>
<h4 id="twilight-mention"><a href="#twilight-mention"><code>twilight-mention</code></a></h4>
<p>Create display formatters for various model types that format mentions. For
example, it can create formatters for mentioning a channel or emoji, or
pinging a role or user.</p>
<h4 id="twilight-util"><a href="#twilight-util"><code>twilight-util</code></a></h4>
<p>Utility crate that adds utilities to the twilight ecosystem that do not fit
in any other crate. Currently, it contains:</p>
<ul>
<li>A trait to make extracting data from Discord identifiers (Snowflakes)
easier;</li>
<li>A calculator to calculate the permissions of a member in a guild or
channel.</li>
</ul>
<h4 id="twilight-gateway-queue"><a href="#twilight-gateway-queue"><code>twilight-gateway-queue</code></a></h4>
<p>A trait and some implementations that are used by the gateway to ratelimit
identify calls. Developers should prefer to use the re-exports of these
crates through the gateway.</p>
<h3 id="examples"><a href="#examples">Examples</a></h3>
<p>The following example is a template for bootstrapping a new bot using
Twilight’s HTTP and gateway clients with its in-memory cache. In order to
run this, replace the contents of a new project’s <code>main.rs</code> file with the
following. Be sure to set the <code>DISCORD_TOKEN</code> environment variable to your
bot’s token. You must also depend on <code>futures</code>, <code>tokio</code>,
<code>twilight-cache-inmemory</code>, <code>twilight-gateway</code>, <code>twilight-http</code>, and
<code>twilight-model</code> in your <code>Cargo.toml</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::{env, error::Error, sync::Arc};
<span class="kw">use </span>futures::stream::StreamExt;
<span class="kw">use </span>twilight_cache_inmemory::{InMemoryCache, ResourceType};
<span class="kw">use </span>twilight_gateway::{Cluster, Event};
<span class="kw">use </span>twilight_http::Client <span class="kw">as </span>HttpClient;
<span class="kw">use </span>twilight_model::gateway::Intents;

<span class="attr">#[tokio::main]
</span><span class="kw">async fn </span>main() -&gt; anyhow::Result&lt;()&gt; {
    <span class="kw">let </span>token = env::var(<span class="string">&quot;DISCORD_TOKEN&quot;</span>)<span class="question-mark">?</span>;

    <span class="comment">// Use intents to only receive guild message events.

    // A cluster is a manager for multiple shards that by default
    // creates as many shards as Discord recommends.
    </span><span class="kw">let </span>(cluster, <span class="kw-2">mut </span>events) = Cluster::new(token.to_owned(), Intents::GUILD_MESSAGES | Intents::MESSAGE_CONTENT).<span class="kw">await</span><span class="question-mark">?</span>;
    <span class="kw">let </span>cluster = Arc::new(cluster);

    <span class="comment">// Start up the cluster.
    </span><span class="kw">let </span>cluster_spawn = Arc::clone(<span class="kw-2">&amp;</span>cluster);

    <span class="comment">// Start all shards in the cluster in the background.
    </span>tokio::spawn(<span class="kw">async move </span>{
        cluster_spawn.up().<span class="kw">await</span>;
    });

    <span class="comment">// HTTP is separate from the gateway, so create a new client.
    </span><span class="kw">let </span>http = Arc::new(HttpClient::new(token));

    <span class="comment">// Since we only care about new messages, make the cache only
    // cache new messages.
    </span><span class="kw">let </span>cache = InMemoryCache::builder()
        .resource_types(ResourceType::MESSAGE)
        .build();

    <span class="comment">// Process each event as they come in.
    </span><span class="kw">while let </span><span class="prelude-val">Some</span>((shard_id, event)) = events.next().<span class="kw">await </span>{
        <span class="comment">// Update the cache with the event.
        </span>cache.update(<span class="kw-2">&amp;</span>event);

        tokio::spawn(handle_event(shard_id, event, Arc::clone(<span class="kw-2">&amp;</span>http)));
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="kw">async fn </span>handle_event(
    shard_id: u64,
    event: Event,
    http: Arc&lt;HttpClient&gt;,
) -&gt; <span class="prelude-ty">Result</span>&lt;(), Box&lt;<span class="kw">dyn </span>Error + Send + Sync&gt;&gt; {
    <span class="kw">match </span>event {
        Event::MessageCreate(msg) <span class="kw">if </span>msg.content == <span class="string">&quot;!ping&quot; </span>=&gt; {
            http.create_message(msg.channel_id)
                .content(<span class="string">&quot;Pong!&quot;</span>)<span class="question-mark">?
                </span>.<span class="kw">await</span><span class="question-mark">?</span>;
        }
        Event::ShardConnected(<span class="kw">_</span>) =&gt; {
            <span class="macro">println!</span>(<span class="string">&quot;Connected on shard {shard_id}&quot;</span>);
        }
        <span class="comment">// Other events here...
        </span><span class="kw">_ </span>=&gt; {}
    }

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h3 id="license"><a href="#license">License</a></h3>
<p>All first-party crates are licensed under <a href="https://github.com/twilight-rs/twilight/blob/main/LICENSE.md">ISC</a></p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="twilight" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.0-nightly (ee0412d1e 2023-01-07)" data-search-js="search-181581080540673f.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-58836c674e2f7bd2.css" ></div></body></html>